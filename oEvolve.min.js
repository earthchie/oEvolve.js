/**
 * @name oEvolve.js
 * @version 1.1.1
 * @update June 27, 2017
 * @website https://github.com/earthchie/oEvolve.js
 * @author Earthchie https://facebook.com/earthchie/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
function oEvolve(t,e){"use strict";t=t||{},(e=e||{}).proto=e.proto||{};var n=function(t,n,r){return e.proto[n]=r,-1===i.indexOf(n)&&i.push(n),t instanceof Array?t[n]=r:Object.setPrototypeOf(t,e.proto),t},i=["__ref"];if(t instanceof Array)for(var r in e.proto)t[r]=e.proto[r];else Object.setPrototypeOf(t,e.proto);t instanceof Array||(n(t,"__extend",function(t){return oEvolve.extend(this,t),this}),n(t,"__concat",function(t){return oEvolve.extend(this,t),this}),n(t,"__entries",function(){var t=this.__clone();return{next:function(){return t.length<1?{value:void 0,done:!0}:{value:t.__shift(!0),done:!1}}}}),n(t,"__every",function(t){var e=!0;return this.__forEach(function(n,i,r){e=e&&t(n,i,r)}),e}),n(t,"__fill",function(t){return this.__map(function(){return t}),this}),n(t,"__filter",function(t){var e=this;for(r in e)e.hasOwnProperty(r)&&-1===i.indexOf(r)&&(t(e[r],r,e)||delete e[r]);return e}),n(t,"__find",function(t){var e=this;for(r in e)if(e.hasOwnProperty(r)&&-1===i.indexOf(r)&&t(e[r],r,e))return e[r]}),n(t,"__findIndex",function(t){var e=this;for(r in e)if(e.hasOwnProperty(r)&&-1===i.indexOf(r)&&t(e[r],r,e))return r;return!1}),n(t,"__forEach",function(t){var e=this;for(r in e)e.hasOwnProperty(r)&&-1===i.indexOf(r)&&t(e[r],r,e);return e}),n(t,"__includes",function(t){return!!this.__indexOf(t)}),n(t,"__indexOf",function(t,e,n){var o,s=this;n=n||"";for(r in s)if(s.hasOwnProperty(r)&&-1===i.indexOf(r)){if(s[r]==t)return n+r;if(s[r].__isEvolved&&s[r].__isEqual(t))return n+r;if(s[r].__isEvolved&&e&&!1!==(o=s[r].__indexOf(t,e,r+".")))return o}return!1}),n(t,"__join",function(t){return this.__reduce(function(e,n){return e=e+t+n}),this.value}),n(t,"__keys",function(){var t=this.__clone();return{next:function(){return t.length<1?{value:void 0,done:!0}:{value:t.__shift(!0)[1],done:!1}}}}),n(t,"__lastIndexOf",function(t,e,n){var o,s=this,f=!1;n=n||"";for(r in s)s.hasOwnProperty(r)&&-1===i.indexOf(r)&&(s[r]==t&&(f=n+r),s[r].__isEvolved&&s[r].__isEqual(t)&&(f=n+r),s[r].__isEvolved&&e&&!1!==(o=s[r].__lastIndexOf(t,e,r+"."))&&(f=o));return f}),n(t,"__map",function(t){var e=this;for(r in e)e.hasOwnProperty(r)&&-1===i.indexOf(r)&&(e[r]=t(e[r],r,e)||e[r]);return e}),n(t,"__pop",function(t){var e,n;return this.__forEach(function(t,i){(n={})[i]=t,e=i}),delete this[e],t?[n[e],e]:n[e]}),n(t,"__reduce",function(t){var e,n,i,r=this,o=r.__clone();return r.__filter(function(){return!1}),o.__forEach(function(r){void 0===e?e=r:(void 0!==(i=t(e,r))&&(n=i),e=n)}),void 0!==n&&(r.value=n),n}),n(t,"__reduceRight",function(t){return this.__reverse().__reduce(t)}),n(t,"__reverse",function(){var t=this,e=this.__clone();return t.__filter(function(){return!1}),Object.keys(e).reverse().forEach(function(n){t[n]=e[n]}),t}),n(t,"__shift",function(t){var e,n=this;for(r in n)if(n.hasOwnProperty(r)&&-1===i.indexOf(r))return e=n[r],delete n[r],t?[e,r]:e}),n(t,"__some",function(t){var e=!1;return this.__forEach(function(n,i,r){e=e||t(n,i,r)}),e}),n(t,"__values",function(){var t=this.__clone();return{next:function(){return t.length<1?{value:void 0,done:!0}:{value:t.__shift(!0)[0],done:!1}}}})),n(t,"__clone",function(t){return void 0===t&&(t=!1),t?new oEvolve(JSON.parse(this.toString()),{proto:e.proto}):new oEvolve(JSON.parse(this.toString()),{})}),n(t,"__data",function(t){return JSON.parse(this.toString())}),n(t,"__diff",function(t,e){return void 0===e&&(e=t||{},t=this),t.__isEvolved&&(t=t.__data()),e.__isEvolved&&(e=e.__data()),oEvolve.diff(t,e)}),n(t,"__isEqual",function(t){return oEvolve.isEqual(this.__data(),t)}),n(t,"__get",function(t){return oEvolve.get(this,t)}),n(t,"__unbindAll",function(){n(this,"__bindListeners",[])}),n(t,"__bind",function(t,e){if(void 0===e&&t instanceof HTMLElement&&(e=t,t=!1),e instanceof HTMLElement){var i=e.innerHTML,r=this;return n(r,"__ref",r),e.innerHTML=r.toString(i),r.__bindListeners||n(r,"__bindListeners",[]),r.__bindListeners.push(function(){e instanceof HTMLElement&&("function"==typeof t&&(r=new oEvolve(t(r.__data())||r.__data(),{})),e.innerHTML=r.toString(i))}),{binder_id:r.__bindListeners.length-1,unbind:function(){r.__bindListeners[this.binder_id]&&r.__bindListeners.splice(this.binder_id,1)}}}}),n(t,"__set",function(t,e){oEvolve.set(this,t,e)}),n(t,"__sortKeys",function(t,e){var n=this,i=this.__clone();return n.__filter(function(){return!1}),Object.keys(i).sort(function(t,e){return t-e}).forEach(function(t){n[t]=i[t]}),n}),n(t,"toString",function(t){var e,n,i;return"string"==typeof t&&""!==t?(e=this,i=t,((i.match(/\{\{(.*?)\}\}/g)||[]).map(function(t){return t.replace(/\{|\}/g,"")})||[]).map(function(t){(n=t.split("||"))[1]=n[1]||"",i=i.replace(new RegExp("{{"+t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"}}","g"),e.__get(n[0])||n[1])}),i):!0===t?JSON.stringify(this,"",2):JSON.stringify(this)}),n(t,"toObject",function(){return this.__data()}),n(t,"addEventListener",function(t,e){if("string"==typeof t&&"function"==typeof e){var i=this,r={},o=["watch","create","update","delete"],s=!1;if(t.split(" ").forEach(function(t){if(o.indexOf(t)>-1){var f,_="__"+t+"Listeners";i[_]||n(i,_,{}),f=e.name||Object.keys(i[_]).length,r[_]||(r[_]=[]),r[_].push(f),i[_][f]=e,s=s||!0}}),s)return{listeners:r,removeEventListener:function(){var t,e=this.listeners;for(t in e)e.hasOwnProperty(t)&&i[t]&&e[t].forEach(function(e){delete i[t][e]})}};console.warn("addEventListener only support:",o.join(", "))}}),n(t,"removeEventListener",function(t,e){if("string"==typeof t&&"function"==typeof e){var n=this;t.split(" ").forEach(function(t){var i="__"+t+"Listeners";n[i]&&"function"==typeof e&&n[i][e.name]&&delete n[i][e.name]})}}),n(t,"removeAllEventListeners",function(t){if("string"==typeof t){var e=this;t.split(" ").forEach(function(t){var i="__"+t+"Listeners";e[i]&&n(e,i,{})})}}),t=new Proxy(t,{get:function(t,e){return t instanceof Array||"length"!==e?"__isEvolved"===e||t[e]:Object.keys(t).length},set:function(n,r,o){var s,f,_,u,a,c,v={watch:!0,bind:!0,create:!1,update:!1,delete:!1};n.__ref&&(s=n.__ref.__data()),n[r]=o,"object"!=typeof t[r]||t[r].__isEvolved||-1!==i.indexOf(r)||(e.proto.__ref=n.__ref||t,t[r]=new oEvolve(t[r],e)),n.__ref&&(f=n.__ref.__data()),_=oEvolve.diff(s,f);for(u in _)_.hasOwnProperty(u)&&(v[_[u]]=v[_[u]]||!0);for(u in v)if(v.hasOwnProperty(u)&&v[u]&&n.__ref){c=n.__ref["__"+u+"Listeners"];for(a in c)"function"==typeof c[a]&&Object.keys(_).length&&c[a](f,s,_)}return o},deleteProperty:function(t,e){if(t.hasOwnProperty(e)){var n,i,r,o,s,f,_={watch:!0,bind:!0,create:!1,update:!1,delete:!1};t.__ref&&(n=t.__ref.__data()),delete t[e],t.__ref&&(i=t.__ref.__data()),r=oEvolve.diff(n,i);for(s in r)r.hasOwnProperty(s)&&(_[r[s]]=_[r[s]]||!0);for(s in _)if(_.hasOwnProperty(s)&&_[s]){f=t["__"+s+"Listeners"];for(o in f)"function"==typeof f[o]&&Object.keys(r).length&&f[o](i,n,r)}return!0}}});for(r in t)t.hasOwnProperty(r)&&!t[r].__isEvolved&&"object"==typeof t[r]&&-1===i.indexOf(r)&&(e.proto.__ref=t.__ref||t,t[r]=new oEvolve(t[r],e));return t}oEvolve.diff=function(t,e){"use strict";var n,i={VALUE_CREATED:"create",VALUE_UPDATED:"update",VALUE_DELETED:"delete",VALUE_UNCHANGED:"unchanged",map:function(t,e){var n,i,r;if(this.isFunction(t)||this.isFunction(e))throw"Invalid argument. Function given, object expected.";if(this.isValue(t)||this.isValue(e))return this.compareValues(t,e);i={};for(n in t)t.hasOwnProperty(n)&&!this.isFunction(t[n])&&(r=void 0,void 0!==e[n]&&(r=e[n]),i[n]=this.map(t[n],r));for(n in e)e.hasOwnProperty(n)&&!this.isFunction(e[n])&&void 0===i[n]&&(i[n]=this.map(void 0,e[n]));return i},compareValues:function(t,e){return t===e?this.VALUE_UNCHANGED:this.isDate(t)&&this.isDate(e)&&t.getTime()===e.getTime()?this.VALUE_UNCHANGED:void 0===t?this.VALUE_CREATED:void 0===e?this.VALUE_DELETED:this.VALUE_UPDATED},isFunction:function(t){return"[object Function]"==={}.toString.apply(t)},isArray:function(t){return"[object Array]"==={}.toString.apply(t)},isObject:function(t){return"[object Object]"==={}.toString.apply(t)},isDate:function(t){return"[object Date]"==={}.toString.apply(t)},isValue:function(t){return!this.isObject(t)&&!this.isArray(t)}},r=oEvolve.deflate(i.map(t||{},e||{}));for(n in r)"unchanged"===r[n]&&delete r[n];return r},oEvolve.get=function(t,e){"use strict";if("string"==typeof e)for(e=e.replace(/\[(\w+)\]/g,".$1").split(".");t&&e.length>0;)t=t[e.shift()];return t},oEvolve.set=function(t,e,n){"use strict";var i=t,r=function(t,e,n){n||(n=i);var o=t.replace(/\[(\w+)\]/g,".$1").split(/\./);o.length<2?(n[o[0]],n[o[0]]=e):(n[o[0]]||(n[o[0]]={}),n=n[o.shift()],r(o.join("."),e,n))};if("string"==typeof e)return r(e,n),i},oEvolve.inflate=function(t){"use strict";var e,n={};for(e in t)t.hasOwnProperty(e)&&oEvolve.set(n,e,t[e]);return n},oEvolve.deflate=function(t){"use strict";var e=function(t){var n,i,r,o={};t.__isEvolved&&(t=t.__data());for(n in t)if(t.hasOwnProperty(n))if("object"==typeof t[n]){r=e(t[n]);for(i in r)r.hasOwnProperty(i)&&(o[n+"."+i]=r[i])}else o[n]=t[n];return o};return e(t)},oEvolve.isEqual=function(t,e){"use strict";return!(t instanceof Function)&&t instanceof Object&&!(e instanceof Function)&&e instanceof Object&&JSON.stringify(t)===JSON.stringify(e)},oEvolve.extend=function(){"use strict";var t,e,n,i=arguments[0];for(n in arguments){t=arguments[n];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},oEvolve.concat=oEvolve.extend;