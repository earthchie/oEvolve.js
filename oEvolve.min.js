/**
 * @name oEvolve.js
 * @version 1.2.0
 * @update October 11, 2017
 * @website https://github.com/earthchie/oEvolve.js
 * @author Earthchie https://facebook.com/earthchie/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
function oEvolve(c,d){'use strict';c=c||{},d=d||{},d.proto=d.proto||{};var g,e=function(h,j,k){return d.proto[j]=k,-1===f.indexOf(j)&&f.push(j),h instanceof Array?h[j]=k:Object.setPrototypeOf(h,d.proto),h},f=['__ref'];if(c instanceof Array)for(var g in d.proto)c[g]=d.proto[g];else Object.setPrototypeOf(c,d.proto);for(g in c instanceof Array||(e(c,'__extend',function(h){return oEvolve.extend(this,h),this}),e(c,'__concat',function(h){return oEvolve.extend(this,h),this}),e(c,'__entries',function(){var h=this.__clone();return{next:function(){return 1>h.length?{value:void 0,done:!0}:{value:h.__shift(!0),done:!1}}}}),e(c,'__every',function(h){var j=!0;return this.__forEach(function(k,l,m){j=j&&h(k,l,m)}),j}),e(c,'__fill',function(h){return this.__map(function(){return h}),this}),e(c,'__filter',function(h){var j=this;for(g in j)j.hasOwnProperty(g)&&-1===f.indexOf(g)&&(h(j[g],g,j)||delete j[g]);return j}),e(c,'__find',function(h){var j=this;for(g in j)if(j.hasOwnProperty(g)&&-1===f.indexOf(g)&&h(j[g],g,j))return j[g]}),e(c,'__findIndex',function(h){var j=this;for(g in j)if(j.hasOwnProperty(g)&&-1===f.indexOf(g)&&h(j[g],g,j))return g;return!1}),e(c,'__forEach',function(h){var j=this;for(g in j)j.hasOwnProperty(g)&&-1===f.indexOf(g)&&h(j[g],g,j);return j}),e(c,'__includes',function(h){return!!this.__indexOf(h)}),e(c,'__indexOf',function(h,j,k){var m,l=this;for(g in k=k||'',l)if(l.hasOwnProperty(g)&&-1===f.indexOf(g)){if(l[g]==h)return k+g;if(l[g].__isEvolved&&l[g].__isEqual(h))return k+g;if(l[g].__isEvolved&&j&&(m=l[g].__indexOf(h,j,g+'.'),!1!==m))return m}return!1}),e(c,'__join',function(h){return this.__reduce(function(j,k){return j=j+h+k,j}),this.value}),e(c,'__keys',function(){var h=this.__clone();return{next:function(){return 1>h.length?{value:void 0,done:!0}:{value:h.__shift(!0)[1],done:!1}}}}),e(c,'__lastIndexOf',function(h,j,k){var n,l=this,m=!1;for(g in k=k||'',l)l.hasOwnProperty(g)&&-1===f.indexOf(g)&&(l[g]==h&&(m=k+g),l[g].__isEvolved&&l[g].__isEqual(h)&&(m=k+g),l[g].__isEvolved&&j&&(n=l[g].__lastIndexOf(h,j,g+'.'),!1!==n&&(m=n)));return m}),e(c,'__map',function(h){var j=this;for(g in j)j.hasOwnProperty(g)&&-1===f.indexOf(g)&&(j[g]=h(j[g],g,j)||j[g]);return j}),e(c,'__pop',function(h){var j,k;return this.__forEach(function(l,m){k={},k[m]=l,j=m}),delete this[j],h?[k[j],j]:k[j]}),e(c,'__reduce',function(h){var l,m,n,j=this,k=j.__clone();return j.__filter(function(){return!1}),k.__forEach(function(o){'undefined'==typeof l?l=o:(n=h(l,o),'undefined'!=typeof n&&(m=n),l=m)}),'undefined'!=typeof m&&(j.value=m),m}),e(c,'__reduceRight',function(h){var j=this;return j.__reverse().__reduce(h)}),e(c,'__reverse',function(){var h=this,j=this.__clone();return h.__filter(function(){return!1}),Object.keys(j).reverse().forEach(function(k){h[k]=j[k]}),h}),e(c,'__shift',function(h){var k,j=this;for(g in j)if(j.hasOwnProperty(g)&&-1===f.indexOf(g))return k=j[g],delete j[g],h?[k,g]:k}),e(c,'__some',function(h){var j=!1;return this.__forEach(function(k,l,m){j=j||h(k,l,m)}),j}),e(c,'__values',function(){var h=this.__clone();return{next:function(){return 1>h.length?{value:void 0,done:!0}:{value:h.__shift(!0)[0],done:!1}}}})),e(c,'__clone',function(h){return'undefined'==typeof h&&(h=!1),h?new oEvolve(JSON.parse(this.toString()),{proto:d.proto}):new oEvolve(JSON.parse(this.toString()),{})}),e(c,'__data',function(){return JSON.parse(this.toString())}),e(c,'__diff',function(h,j){return'undefined'==typeof j&&(j=h||{},h=this),h.__isEvolved&&(h=h.__data()),j.__isEvolved&&(j=j.__data()),oEvolve.diff(h,j)}),e(c,'__isEqual',function(h){return oEvolve.isEqual(this.__data(),h)}),e(c,'__get',function(h){return oEvolve.get(this,h)}),e(c,'__unbindAll',function(){e(this,'__bindListeners',[])}),e(c,'__bind',function(h,j){if('undefined'==typeof j&&h instanceof HTMLElement&&(j=h,h=!1),j instanceof HTMLElement){var k=j.innerHTML,l=this;return e(l,'__ref',l),j.innerHTML=l.toString(k),l.__bindListeners||e(l,'__bindListeners',[]),l.__bindListeners.push(function(){j instanceof HTMLElement&&('function'==typeof h&&(l=new oEvolve(h(l.__data())||l.__data(),{})),j.innerHTML=l.toString(k))}),{binder_id:l.__bindListeners.length-1,unbind:function(){l.__bindListeners[this.binder_id]&&l.__bindListeners.splice(this.binder_id,1)}}}}),e(c,'__set',function(h,j){oEvolve.set(this,h,j)}),e(c,'__sortKeys',function(){var k=this,l=this.__clone();return k.__filter(function(){return!1}),Object.keys(l).sort(function(m,n){return m-n}).forEach(function(m){k[m]=l[m]}),k}),e(c,'toString',function(h){var j,k,l,m;return'string'==typeof h&&''!==h?(j=this,m=h,k=(m.match(/\{\{(.*?)\}\}/g)||[]).map(function(n){return n.replace(/\{|\}/g,'')})||[],k.map(function(n){l=n.split('||'),l[1]=l[1]||'',m=m.replace(new RegExp('{{'+n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&')+'}}','g'),j.__get(l[0])||l[1])}),m):!0===h?JSON.stringify(this,'',2):JSON.stringify(this)}),e(c,'toObject',function(){return this.__data()}),e(c,'addEventListener',function(h,j){if('string'==typeof h&&'function'==typeof j){var k=this,l={},m=['watch','create','update','delete'],n=!1;if(h.split(' ').forEach(function(o){if(-1<m.indexOf(o)){var q,p='__'+o+'Listeners';k[p]||e(k,p,{}),q=j.name||Object.keys(k[p]).length,l[p]||(l[p]=[]),l[p].push(q),k[p][q]=j,n=n||!0}}),n)return{listeners:l,removeEventListener:function(){var p,o=this.listeners;for(p in o)o.hasOwnProperty(p)&&k[p]&&o[p].forEach(function(q){delete k[p][q]})}};console.warn('addEventListener only support:',m.join(', '))}}),e(c,'removeEventListener',function(h,j){if('string'==typeof h&&'function'==typeof j){var k=this;h.split(' ').forEach(function(l){var m='__'+l+'Listeners';k[m]&&'function'==typeof j&&k[m][j.name]&&delete k[m][j.name]})}}),e(c,'removeAllEventListeners',function(h){if('string'==typeof h){var j=this;h.split(' ').forEach(function(k){var l='__'+k+'Listeners';j[l]&&e(j,l,{})})}}),c=new Proxy(c,{get:function(h,j){return h instanceof Array||'length'!==j?'__isEvolved'===j||h[j]:Object.keys(h).length},set:function(h,j,k){var l,m,n,o,p,q,r={watch:!0,bind:!0,create:!1,update:!1,'delete':!1};for(o in h.__ref&&(l=h.__ref.__data()),h[j]=k,'object'!=typeof c[j]||c[j].__isEvolved||-1!==f.indexOf(j)||(d.proto.__ref=h.__ref||c,c[j]=new oEvolve(c[j],d)),h.__ref&&(m=h.__ref.__data()),n=oEvolve.diff(l,m),n)n.hasOwnProperty(o)&&(r[n[o]]=r[n[o]]||!0);for(o in r)if(r.hasOwnProperty(o)&&r[o]&&h.__ref)for(p in q=h.__ref['__'+o+'Listeners'],q)'function'==typeof q[p]&&Object.keys(n).length&&q[p](m,l,n);return k},deleteProperty:function(h,j){if(h.hasOwnProperty(j)){var k,l,m,n,o,p,q={watch:!0,bind:!0,create:!1,update:!1,'delete':!1};for(o in h.__ref&&(k=h.__ref.__data()),delete h[j],h.__ref&&(l=h.__ref.__data()),m=oEvolve.diff(k,l),m)m.hasOwnProperty(o)&&(q[m[o]]=q[m[o]]||!0);for(o in q)if(q.hasOwnProperty(o)&&q[o])for(n in p=h['__'+o+'Listeners'],p)'function'==typeof p[n]&&Object.keys(m).length&&p[n](l,k,m);return!0}}}),c)c.hasOwnProperty(g)&&!c[g].__isEvolved&&'object'==typeof c[g]&&-1===f.indexOf(g)&&(d.proto.__ref=c.__ref||c,c[g]=new oEvolve(c[g],d));return c}oEvolve.diff=function(c,d){'use strict';var g,f=oEvolve.deflate({VALUE_CREATED:'create',VALUE_UPDATED:'update',VALUE_DELETED:'delete',VALUE_UNCHANGED:'unchanged',map:function(j,k){var l,m,n;if(this.isFunction(j)||this.isFunction(k))throw'Invalid argument. Function given, object expected.';if(this.isValue(j)||this.isValue(k))return this.compareValues(j,k);for(l in m={},j)j.hasOwnProperty(l)&&!this.isFunction(j[l])&&(n=void 0,'undefined'!=typeof k[l]&&(n=k[l]),m[l]=this.map(j[l],n));for(l in k)k.hasOwnProperty(l)&&!(this.isFunction(k[l])||'undefined'!=typeof m[l])&&(m[l]=this.map(void 0,k[l]));return m},compareValues:function(j,k){return j===k?this.VALUE_UNCHANGED:this.isDate(j)&&this.isDate(k)&&j.getTime()===k.getTime()?this.VALUE_UNCHANGED:'undefined'==typeof j?this.VALUE_CREATED:'undefined'==typeof k?this.VALUE_DELETED:this.VALUE_UPDATED},isFunction:function(j){return'[object Function]'==={}.toString.apply(j)},isArray:function(j){return'[object Array]'==={}.toString.apply(j)},isObject:function(j){return'[object Object]'==={}.toString.apply(j)},isDate:function(j){return'[object Date]'==={}.toString.apply(j)},isValue:function(j){return!this.isObject(j)&&!this.isArray(j)}}.map(c||{},d||{}));for(g in f)'unchanged'===f[g]&&delete f[g];return f},oEvolve.get=function(c,d){'use strict';if('string'==typeof d)for(d=d.replace(/\[(\w+)\]/g,'.$1').split('.');c&&0<d.length;)c=c[d.shift()];return c},oEvolve.set=function(c,d,e){'use strict';var f=c,g=function(h,j,k){k||(k=f);var m,l=h.replace(/\[(\w+)\]/g,'.$1').split(/\./);2>l.length?(m=k[l[0]],k[l[0]]=j):(!k[l[0]]&&(k[l[0]]={}),k=k[l.shift()],g(l.join('.'),j,k))};if('string'==typeof d)return g(d,e),f},oEvolve.inflate=function(c){'use strict';var e,d={};for(e in c)c.hasOwnProperty(e)&&oEvolve.set(d,e,c[e]);return d},oEvolve.deflate=function(c,d){'use strict';isNaN(d)||d--;var e=function(f,g){var j,k,l,h={};if(f.__isEvolved&&(f=f.__data()),!isNaN(g)){if(0>=g)return f;g--}for(j in f)if(f.hasOwnProperty(j))if('object'==typeof f[j])for(k in l=e(f[j],g),l)l.hasOwnProperty(k)&&(h[j+'.'+k]=l[k]);else h[j]=f[j];return h};return e(c,d)},oEvolve.isEqual=function(c,d){'use strict';return!(c instanceof Function)&&c instanceof Object&&!(d instanceof Function)&&d instanceof Object&&JSON.stringify(c)===JSON.stringify(d)},oEvolve.extend=function(){'use strict';var d,e,f,c=arguments[0];for(f in arguments)for(e in d=arguments[f],d)Object.prototype.hasOwnProperty.call(d,e)&&(c[e]=d[e]);return c},oEvolve.concat=oEvolve.extend;