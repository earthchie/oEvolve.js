/**
 * @name oEvolve.js
 * @version 1.1.0
 * @update June 26, 2017
 * @website https://github.com/earthchie/oEvolve.js
 * @author Earthchie https://facebook.com/earthchie/
 * @license WTFPL v.2 - http://www.wtfpl.net/
 **/
function oEvolve(t,e){"use strict";t=t||{},(e=e||{}).proto=e.proto||{};var n=function(t,n,r){return e.proto[n]=r,-1===i.indexOf(n)&&i.push(n),t instanceof Array?t[n]=r:Object.setPrototypeOf(t,e.proto),t},i=[];if(t instanceof Array)for(var r in e.proto)t[r]=e.proto[r];else Object.setPrototypeOf(t,e.proto);n(t,"__clone",function(t){return void 0===t&&(t=!1),t?new oEvolve(JSON.parse(this.toString()),{proto:e.proto}):new oEvolve(JSON.parse(this.toString()),{})}),n(t,"__data",function(){return JSON.parse(this.toString())}),n(t,"__diff",function(t,e){return void 0===e&&(e=t||{},t=this),t.__isEvolved&&(t=t.__data()),e.__isEvolved&&(e=e.__data()),oEvolve.diff(t,e)}),n(t,"__isEqual",function(t){return oEvolve.isEqual(this.__data(),t)}),n(t,"__get",function(t){return oEvolve.get(this,t)}),n(t,"__unbindAll",function(){n(this,"__bindListeners",[])}),n(t,"__bind",function(t,e){if(void 0===e&&t instanceof HTMLElement&&(e=t,t=!1),e instanceof HTMLElement){var i=e.innerHTML,r=this;return n(r,"__ref",r),e.innerHTML=r.toString(i),r.__bindListeners||n(r,"__bindListeners",[]),r.__bindListeners.push(function(){e instanceof HTMLElement&&("function"==typeof t&&(r=new oEvolve(t(r.__data())||r.__data(),{})),e.innerHTML=r.toString(i))}),{binder_id:r.__bindListeners.length-1,unbind:function(){r.__bindListeners[this.binder_id]&&r.__bindListeners.splice(this.binder_id,1)}}}}),n(t,"__set",function(t,e){oEvolve.set(this,t,e)}),n(t,"toString",function(t){var e,n,i;return"string"==typeof t&&""!==t?(e=this,i=t,((i.match(/\{\{(.*?)\}\}/g)||[]).map(function(t){return t.replace(/\{|\}/g,"")})||[]).map(function(t){(n=t.split("||"))[1]=n[1]||"",i=i.replace(new RegExp("{{"+t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"}}","g"),e.__get(n[0])||n[1])}),i):!0===t?JSON.stringify(this,"",2):JSON.stringify(this)}),n(t,"toObject",function(){return this.__data()}),n(t,"addEventListener",function(t,e){if("string"==typeof t&&"function"==typeof e){var i=this,r={},o=["watch","create","update","delete"],s=!1;if(t.split(" ").forEach(function(t){if(o.indexOf(t)>-1){var f,a="__"+t+"Listeners";i[a]||n(i,a,{}),f=e.name||Object.keys(i[a]).length,r[a]||(r[a]=[]),r[a].push(f),i[a][f]=e,s=s||!0}}),s)return{listeners:r,removeEventListener:function(){var t,e=this.listeners;for(t in e)e.hasOwnProperty(t)&&i[t]&&e[t].forEach(function(e){delete i[t][e]})}};console.warn("addEventListener only support:",o.join(", "))}}),n(t,"removeEventListener",function(t,e){if("string"==typeof t&&"function"==typeof e){var n=this;t.split(" ").forEach(function(t){var i="__"+t+"Listeners";n[i]&&"function"==typeof e&&n[i][e.name]&&delete n[i][e.name]})}}),n(t,"removeAllEventListeners",function(t){if("string"==typeof t){var e=this;t.split(" ").forEach(function(t){var i="__"+t+"Listeners";e[i]&&n(e,i,{})})}}),t=new Proxy(t,{get:function(t,e){return t instanceof Array||"length"!==e?"__isEvolved"===e||t[e]:Object.keys(t).length},set:function(n,r,o){var s,f,a,c,u,_,v={watch:!0,bind:!0,create:!1,update:!1,delete:!1};n.__ref&&(s=n.__ref.__data()),n[r]=o,"object"!=typeof t[r]||t[r].__isEvolved||-1!==i.indexOf(r)||(e.proto.__ref=n.__ref||t,t[r]=new oEvolve(t[r],e)),n.__ref&&(f=n.__ref.__data()),a=oEvolve.diff(s,f);for(c in a)a.hasOwnProperty(c)&&(v[a[c]]=v[a[c]]||!0);for(c in v)if(v.hasOwnProperty(c)&&v[c]&&n.__ref){_=n.__ref["__"+c+"Listeners"];for(u in _)"function"==typeof _[u]&&Object.keys(a).length&&_[u](f,s,a)}return o},deleteProperty:function(t,e){if(t.hasOwnProperty(e)){var n,i,r,o,s,f,a={watch:!0,bind:!0,create:!1,update:!1,delete:!1};t.__ref&&(n=t.__ref.__data()),delete t[e],t.__ref&&(i=t.__ref.__data()),r=oEvolve.diff(n,i);for(s in r)r.hasOwnProperty(s)&&(a[r[s]]=a[r[s]]||!0);for(s in a)if(a.hasOwnProperty(s)&&a[s]){f=t["__"+s+"Listeners"];for(o in f)"function"==typeof f[o]&&Object.keys(r).length&&f[o](i,n,r)}return!0}}});for(r in t)t.hasOwnProperty(r)&&!t[r].__isEvolved&&"object"==typeof t[r]&&-1===i.indexOf(r)&&(e.proto.__ref=t.__ref||t,t[r]=new oEvolve(t[r],e));return t}oEvolve.diff=function(t,e){"use strict";var n,i={VALUE_CREATED:"create",VALUE_UPDATED:"update",VALUE_DELETED:"delete",VALUE_UNCHANGED:"unchanged",map:function(t,e){var n,i,r;if(this.isFunction(t)||this.isFunction(e))throw"Invalid argument. Function given, object expected.";if(this.isValue(t)||this.isValue(e))return this.compareValues(t,e);i={};for(n in t)t.hasOwnProperty(n)&&!this.isFunction(t[n])&&(r=void 0,void 0!==e[n]&&(r=e[n]),i[n]=this.map(t[n],r));for(n in e)e.hasOwnProperty(n)&&!this.isFunction(e[n])&&void 0===i[n]&&(i[n]=this.map(void 0,e[n]));return i},compareValues:function(t,e){return t===e?this.VALUE_UNCHANGED:this.isDate(t)&&this.isDate(e)&&t.getTime()===e.getTime()?this.VALUE_UNCHANGED:void 0===t?this.VALUE_CREATED:void 0===e?this.VALUE_DELETED:this.VALUE_UPDATED},isFunction:function(t){return"[object Function]"==={}.toString.apply(t)},isArray:function(t){return"[object Array]"==={}.toString.apply(t)},isObject:function(t){return"[object Object]"==={}.toString.apply(t)},isDate:function(t){return"[object Date]"==={}.toString.apply(t)},isValue:function(t){return!this.isObject(t)&&!this.isArray(t)}},r=oEvolve.deflate(i.map(t||{},e||{}));for(n in r)"unchanged"===r[n]&&delete r[n];return r},oEvolve.get=function(t,e){"use strict";if("string"==typeof e)for(e=e.replace(/\[(\w+)\]/g,".$1").split(".");t&&e.length>0;)t=t[e.shift()];return t},oEvolve.set=function(t,e,n){"use strict";var i=t,r=function(t,e,n){n||(n=i);var o=t.replace(/\[(\w+)\]/g,".$1").split(/\./);o.length<2?(n[o[0]],n[o[0]]=e):(n[o[0]]||(n[o[0]]={}),n=n[o.shift()],r(o.join("."),e,n))};if("string"==typeof e)return r(e,n),i},oEvolve.inflate=function(t){"use strict";var e,n={};for(e in t)t.hasOwnProperty(e)&&oEvolve.set(n,e,t[e]);return n},oEvolve.deflate=function(t){"use strict";var e=function(t){var n,i,r,o={};for(n in t)if(t.hasOwnProperty(n))if("object"==typeof t[n]){r=e(t[n]);for(i in r)r.hasOwnProperty(i)&&(o[n+"."+i]=r[i])}else o[n]=t[n];return o};return e(t)},oEvolve.isEqual=function(t,e){"use strict";return!(t instanceof Function)&&t instanceof Object&&!(e instanceof Function)&&e instanceof Object&&JSON.stringify(t)===JSON.stringify(e)};